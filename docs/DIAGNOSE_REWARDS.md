# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –Ω–∞–≥—Ä–∞–¥–∞–º–∏ Twitch

## –ü—Ä–æ–±–ª–µ–º–∞
–°–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —á–∞—Ç–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–∞–≥—Ä–∞–¥—ã - –Ω–µ—Ç.

## –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Å–±–æ—Ä–∞

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç
```bash
npm run diagnose-rewards
```

–≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç:
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –î–æ—Å—Ç—É–ø–µ–Ω –ª–∏ endpoint
- –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ `npm run server` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è:
```
[SERVER] ‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3001
[SERVER] ‚úÖ Endpoint –¥–ª—è –Ω–∞–≥—Ä–∞–¥: http://localhost:3001/api/eventsub/callback
[TWITCH] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∫–∞–Ω–∞–ª—É: ...
[TWITCH] –£—Å–ø–µ—à–Ω–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –∫–∞–Ω–∞–ª—É ...
```

**–í–æ–ø—Ä–æ—Å:** –í–∏–¥–Ω—ã –ª–∏ —ç—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è?

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —Å–æ–∑–¥–∞–Ω–∞ –ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ EventSub

**–°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ Twitch Developer Console**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://dev.twitch.tv/console
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "EventSub Subscriptions"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ —Ç–∏–ø–∞ `channel.channel_points_custom_reward_redemption.add`

**–°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ API**
```bash
curl -X GET "https://api.twitch.tv/helix/eventsub/subscriptions" \
  -H "Client-Id: YOUR_CLIENT_ID" \
  -H "Authorization: Bearer YOUR_APP_ACCESS_TOKEN"
```

**–í–æ–ø—Ä–æ—Å:** –ï—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞? –ö–∞–∫–æ–π —É –Ω–µ—ë —Å—Ç–∞—Ç—É—Å?

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤–µ–±-—Ö—É–∫–∞

**–í–∞–∂–Ω–æ:** Twitch –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤–µ–±-—Ö—É–∫–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ –ø—É–±–ª–∏—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ URL.

**–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok: `ngrok http 3001`
- –ò–ª–∏ localtunnel: `lt --port 3001`
- URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–∫–∞–∑–∞–Ω –≤ –ø–æ–¥–ø–∏—Å–∫–µ EventSub

**–í–æ–ø—Ä–æ—Å:** –ö–∞–∫–æ–π URL —É–∫–∞–∑–∞–Ω –≤ –ø–æ–¥–ø–∏—Å–∫–µ? –î–æ—Å—Ç—É–ø–µ–Ω –ª–∏ –æ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞?

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –Ω–∞–≥—Ä–∞–¥—ã

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: `npm run server`
2. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –Ω–∞–≥—Ä–∞–¥—É –≤ Twitch
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
- `[SERVER] üì• –ü–æ–ª—É—á–µ–Ω POST –∑–∞–ø—Ä–æ—Å –Ω–∞ /api/eventsub/callback`
- `[REWARDS] –ù–∞–≥—Ä–∞–¥–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞: ...`

**–í–æ–ø—Ä–æ—Å:** –ü–æ—è–≤–ª—è—é—Ç—Å—è –ª–∏ —ç—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –Ω–∞–≥—Ä–∞–¥—ã?

### 6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í —Ñ–∞–π–ª–µ `.env` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å:
```env
TWITCH_WEBHOOK_SECRET=–≤–∞—à_—Å–µ–∫—Ä–µ—Ç
```

**–í–∞–∂–Ω–æ:** –°–µ–∫—Ä–µ—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Å–µ–∫—Ä–µ—Ç–æ–º, —É–∫–∞–∑–∞–Ω–Ω—ã–º –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ EventSub.

**–í–æ–ø—Ä–æ—Å:** –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ `TWITCH_WEBHOOK_SECRET`? –°–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ –æ–Ω —Å —Å–µ–∫—Ä–µ—Ç–æ–º –≤ –ø–æ–¥–ø–∏—Å–∫–µ?

### 7. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏

–ü–æ–¥–ø–∏—Å–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å:
- `enabled` - –∞–∫—Ç–∏–≤–Ω–∞, –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å
- `webhook_callback_verification_pending` - –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- `webhook_callback_verification_failed` - –Ω–µ –ø—Ä–æ—à–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
- `notification_failures_exceeded` - —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ—à–∏–±–æ–∫, –æ—Ç–æ–∑–≤–∞–Ω–∞
- `authorization_revoked` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –æ—Ç–æ–∑–≤–∞–Ω–∞
- `user_removed` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω

**–í–æ–ø—Ä–æ—Å:** –ö–∞–∫–æ–π —Å—Ç–∞—Ç—É—Å —É –ø–æ–¥–ø–∏—Å–∫–∏?

### 8. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall/–∞–Ω—Ç–∏–≤–∏—Ä—É—Å

Firewall –∏–ª–∏ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.

**–í–æ–ø—Ä–æ—Å:** –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ª–∏ firewall –ø–æ—Ä—Ç 3001?

### 9. –¢–µ—Å—Ç –≤–µ–±-—Ö—É–∫–∞ –≤—Ä—É—á–Ω—É—é

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Twitch CLI –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
twitch event trigger channel.channel_points_custom_reward_redemption.add \
  --broadcaster-user-id YOUR_BROADCASTER_ID \
  --reward-id YOUR_REWARD_ID \
  --user-id TEST_USER_ID \
  --secret YOUR_WEBHOOK_SECRET \
  -F http://localhost:3001/api/eventsub/callback
```

–ò–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π POST –∑–∞–ø—Ä–æ—Å:
```bash
curl -X POST http://localhost:3001/api/eventsub/callback \
  -H "Content-Type: application/json" \
  -H "Twitch-Eventsub-Message-Type: notification" \
  -d '{"subscription":{"type":"channel.channel_points_custom_reward_redemption.add"},"event":{"reward":{"title":"Test","cost":100},"user_name":"TestUser"}}'
```

**–í–æ–ø—Ä–æ—Å:** –ü–æ—è–≤–ª—è—é—Ç—Å—è –ª–∏ –ª–æ–≥–∏ –ø—Ä–∏ —Ç–µ—Å—Ç–æ–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ?

## –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### ‚ùå –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞
**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É —á–µ—Ä–µ–∑ Twitch API –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Twitch Developer Console

### ‚ùå URL –≤–µ–±-—Ö—É–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok –∏–ª–∏ localtunnel –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ URL

### ‚ùå –ü–æ–¥–ø–∏—Å–∫–∞ –æ—Ç–æ–∑–≤–∞–Ω–∞ –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏, —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –ø–æ–¥–ø–∏—Å–∫—É

### ‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π webhook secret
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ–∫—Ä–µ—Ç –≤ `.env` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å–µ–∫—Ä–µ—Ç–æ–º –≤ –ø–æ–¥–ø–∏—Å–∫–µ

### ‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall, —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç

## –ß—Ç–æ —Å–æ–±—Ä–∞—Ç—å –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

1. ‚úÖ –í—ã–≤–æ–¥ `npm run diagnose-rewards`
2. ‚úÖ –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ (–ø–µ—Ä–≤—ã–µ 20-30 —Å—Ç—Ä–æ–∫)
3. ‚úÖ –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –Ω–∞–≥—Ä–∞–¥—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
4. ‚úÖ –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–æ–∫ EventSub (—á–µ—Ä–µ–∑ API –∏–ª–∏ Console)
5. ‚úÖ URL –≤–µ–±-—Ö—É–∫–∞ –∏–∑ –ø–æ–¥–ø–∏—Å–∫–∏
6. ‚úÖ –ó–Ω–∞—á–µ–Ω–∏–µ `TWITCH_WEBHOOK_SECRET` (—Ç–æ–ª—å–∫–æ —Ñ–∞–∫—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏, –Ω–µ —Å–∞–º —Å–µ–∫—Ä–µ—Ç)

